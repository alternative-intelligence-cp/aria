// ============================================================================
// Aria Standard Library - Bit Manipulation Functions
// ============================================================================
// Using proven collections.aria pattern: separate macro per function
// ============================================================================

// POPCOUNT - Count set bits
%macro GEN_POPCOUNT_8 1
func:popcount_%1 = *int32(%1:x) {
    int32:count = 0;
    %1:val = x;
    int32:i = 0;
    while (i < 8) {
        if ((val & 1) != 0) {
            count = count + 1;
        }
        val = val >> 1;
        i = i + 1;
    }
    return count;
};
%endmacro

%macro GEN_POPCOUNT_16 1
func:popcount_%1 = *int32(%1:x) {
    int32:count = 0;
    %1:val = x;
    int32:i = 0;
    while (i < 16) {
        if ((val & 1) != 0) {
            count = count + 1;
        }
        val = val >> 1;
        i = i + 1;
    }
    return count;
};
%endmacro

%macro GEN_POPCOUNT_32 1
func:popcount_%1 = *int32(%1:x) {
    int32:count = 0;
    %1:val = x;
    int32:i = 0;
    while (i < 32) {
        if ((val & 1) != 0) {
            count = count + 1;
        }
        val = val >> 1;
        i = i + 1;
    }
    return count;
};
%endmacro

%macro GEN_POPCOUNT_64 1
func:popcount_%1 = *int32(%1:x) {
    int32:count = 0;
    %1:val = x;
    int32:i = 0;

GEN_POPCOUNT_8(int8)
GEN_POPCOUNT_16(int16)

func:main = *int8() { return 0; };
