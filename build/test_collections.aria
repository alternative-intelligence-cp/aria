// ============================================================================
// Aria Collections Library Test Suite
// ============================================================================
// Comprehensive tests for all collection functions
// ============================================================================

// Import collection functions (inline for testing)
%macro GEN_CONTAINS 1
func:contains_%1 = *int8(%1[]:arr, int64:length, %1:value) {
    int64:i = 0;
    while (i < length) {
        if (arr[i] == value) {
            return 1;
        }
        i = i + 1;
    }
    return 0;
};
%endmacro

%macro GEN_INDEXOF 1
func:indexOf_%1 = *int64(%1[]:arr, int64:length, %1:value) {
    int64:i = 0;
    while (i < length) {
        if (arr[i] == value) {
            return i;
        }
        i = i + 1;
    }
    return 0 - 1;
};
%endmacro

%macro GEN_COUNT 1
func:count_%1 = *int64(%1[]:arr, int64:length, %1:value) {
    int64:count = 0;
    int64:i = 0;
    while (i < length) {
        if (arr[i] == value) {
            count = count + 1;
        }
        i = i + 1;
    }
    return count;
};
%endmacro

%macro GEN_REVERSE 1
func:reverse_%1 = *int8(%1[]:arr, int64:length) {
    int64:left = 0;
    int64:right = length - 1;
    
    while (left < right) {
        %1:temp = arr[left];
        arr[left] = arr[right];
        arr[right] = temp;
        left = left + 1;
        right = right - 1;
    }
    return 1;
};
%endmacro

%macro GEN_FILL 1
func:fill_%1 = *int8(%1[]:arr, int64:length, %1:value) {
    int64:i = 0;
    while (i < length) {
        arr[i] = value;
        i = i + 1;
    }
    return 1;
};
%endmacro

%macro GEN_MIN_IN_ARRAY 1
func:min_in_array_%1 = *%1(%1[]:arr, int64:length) {
    if (length <= 0) {
        return arr[0];
    }
    %1:min_val = arr[0];
    int64:i = 1;
    while (i < length) {
        if (arr[i] < min_val) {
            min_val = arr[i];
        }
        i = i + 1;
    }
    return min_val;
};
%endmacro

%macro GEN_MAX_IN_ARRAY 1
func:max_in_array_%1 = *%1(%1[]:arr, int64:length) {
    if (length <= 0) {
        return arr[0];
    }
    %1:max_val = arr[0];
    int64:i = 1;
    while (i < length) {
        if (arr[i] > max_val) {
            max_val = arr[i];
        }
        i = i + 1;
    }
    return max_val;
};
%endmacro

%macro GEN_SUM 1
func:sum_%1 = *%1(%1[]:arr, int64:length) {
    %1:total = 0;
    int64:i = 0;
    while (i < length) {
        total = total + arr[i];
        i = i + 1;
    }
    return total;
};
%endmacro

%macro GEN_IS_SORTED 1
func:is_sorted_%1 = *int8(%1[]:arr, int64:length) {
    if (length <= 1) {
        return 1;
    }
    int64:i = 0;
    while (i < length - 1) {
        if (arr[i] > arr[i + 1]) {
            return 0;
        }
        i = i + 1;
    }
    return 1;
};
%endmacro

// Generate test functions for int32
GEN_CONTAINS(int32)
GEN_INDEXOF(int32)
GEN_COUNT(int32)
GEN_REVERSE(int32)
GEN_FILL(int32)
GEN_MIN_IN_ARRAY(int32)
GEN_MAX_IN_ARRAY(int32)
GEN_SUM(int32)
GEN_IS_SORTED(int32)

// Generate for int64 for additional testing
GEN_CONTAINS(int64)
GEN_INDEXOF(int64)
GEN_SUM(int64)

// ----------------------------------------------------------------------------
// Test Functions
// ----------------------------------------------------------------------------

func:test_contains = *int32() {
    puts("Testing contains...");
    
    int32:numbers[5];
    numbers[0] = 10;
    numbers[1] = 20;
    numbers[2] = 30;
    numbers[3] = 40;
    numbers[4] = 50;
    
    int8:found1 = contains_int32(numbers, 5, 30) ? 0;
    int8:found2 = contains_int32(numbers, 5, 99) ? 0;
    
    if (found1 != 1) {
        puts("FAIL: Should find 30 in array");
        return 1;
    }
    
    if (found2 != 0) {
        puts("FAIL: Should not find 99 in array");
        return 1;
    }
    
    puts("contains tests passed!");
    return 0;
};

func:test_indexOf = *int32() {
    puts("Testing indexOf...");
    
    int32:data[6];
    data[0] = 5;
    data[1] = 10;
    data[2] = 15;
    data[3] = 20;
    data[4] = 25;
    data[5] = 15;
    
    int64:idx1 = indexOf_int32(data, 6, 15) ? 0;
    int64:idx2 = indexOf_int32(data, 6, 99) ? 0;
    
    if (idx1 != 2) {
        puts("FAIL: indexOf should return 2 for first occurrence of 15");
        return 1;
    }
    
    if (idx2 != 0 - 1) {
        puts("FAIL: indexOf should return -1 for missing value");
        return 1;
    }
    
    puts("indexOf tests passed!");
    return 0;
};

func:test_count = *int32() {
    puts("Testing count...");
    
    int32:items[8];
    items[0] = 1;
    items[1] = 2;
    items[2] = 3;
    items[3] = 2;
    items[4] = 4;
    items[5] = 2;
    items[6] = 5;
    items[7] = 2;
    
    int64:count1 = count_int32(items, 8, 2) ? 0;
    int64:count2 = count_int32(items, 8, 99) ? 0;
    
    if (count1 != 4) {
        puts("FAIL: Should count 4 occurrences of 2");
        return 1;
    }
    
    if (count2 != 0) {
        puts("FAIL: Should count 0 occurrences of 99");
        return 1;
    }
    
    puts("count tests passed!");
    return 0;
};

func:test_reverse = *int32() {
    puts("Testing reverse...");
    
    int32:vals[5];
    vals[0] = 1;
    vals[1] = 2;
    vals[2] = 3;
    vals[3] = 4;
    vals[4] = 5;
    
    int8:result = reverse_int32(vals, 5) ? 0;
    
    if (vals[0] != 5) {
        puts("FAIL: First element should be 5 after reverse");
        return 1;
    }
    
    if (vals[4] != 1) {
        puts("FAIL: Last element should be 1 after reverse");
        return 1;
    }
    
    if (vals[2] != 3) {
        puts("FAIL: Middle element should stay 3");
        return 1;
    }
    
    puts("reverse tests passed!");
    return 0;
};

func:test_fill = *int32() {
    puts("Testing fill...");
    
    int32:buffer[4];
    buffer[0] = 99;
    buffer[1] = 99;
    buffer[2] = 99;
    buffer[3] = 99;
    
    int8:result = fill_int32(buffer, 4, 42) ? 0;
    
    if (buffer[0] != 42) {
        puts("FAIL: Element 0 should be 42");
        return 1;
    }
    
    if (buffer[3] != 42) {
        puts("FAIL: Element 3 should be 42");
        return 1;
    }
    
    puts("fill tests passed!");
    return 0;
};

func:test_min_max = *int32() {
    puts("Testing min_in_array and max_in_array...");
    
    int32:values[7];
    values[0] = 45;
    values[1] = 12;
    values[2] = 89;
    values[3] = 3;
    values[4] = 67;
    values[5] = 23;
    values[6] = 56;
    
    int32:min_val = min_in_array_int32(values, 7) ? 0;
    int32:max_val = max_in_array_int32(values, 7) ? 0;
    
    if (min_val != 3) {
        puts("FAIL: Minimum should be 3");
        return 1;
    }
    
    if (max_val != 89) {
        puts("FAIL: Maximum should be 89");
        return 1;
    }
    
    puts("min/max tests passed!");
    return 0;
};

func:test_sum = *int32() {
    puts("Testing sum...");
    
    int32:addends[5];
    addends[0] = 10;
    addends[1] = 20;
    addends[2] = 30;
    addends[3] = 40;
    addends[4] = 50;
    
    int32:total = sum_int32(addends, 5) ? 0;
    
    if (total != 150) {
        puts("FAIL: Sum should be 150");
        return 1;
    }
    
    // Test with int64
    int64:big_nums[3];
    big_nums[0] = 1000;
    big_nums[1] = 2000;
    big_nums[2] = 3000;
    
    int64:big_total = sum_int64(big_nums, 3) ? 0;
    
    if (big_total != 6000) {
        puts("FAIL: Sum of int64 should be 6000");
        return 1;
    }
    
    puts("sum tests passed!");
    return 0;
};

func:test_is_sorted = *int32() {
    puts("Testing is_sorted...");
    
    int32:sorted[5];
    sorted[0] = 1;
    sorted[1] = 2;
    sorted[2] = 3;
    sorted[3] = 4;
    sorted[4] = 5;
    
    int32:unsorted[5];
    unsorted[0] = 1;
    unsorted[1] = 5;
    unsorted[2] = 3;
    unsorted[3] = 2;
    unsorted[4] = 4;
    
    int8:check1 = is_sorted_int32(sorted, 5) ? 0;
    int8:check2 = is_sorted_int32(unsorted, 5) ? 0;
    
    if (check1 != 1) {
        puts("FAIL: Sorted array should return 1");
        return 1;
    }
    
    if (check2 != 0) {
        puts("FAIL: Unsorted array should return 0");
        return 1;
    }
    
    puts("is_sorted tests passed!");
    return 0;
};

// ----------------------------------------------------------------------------
// Main Test Runner
// ----------------------------------------------------------------------------

func:main = int32() {
    puts("=== Aria Collections Library Test Suite ===");
    puts("");
    
    int32:failures = 0;
    
    failures = failures + test_contains() ? 0;
    puts("");
    
    failures = failures + test_indexOf() ? 0;
    puts("");
    
    failures = failures + test_count() ? 0;
    puts("");
    
    failures = failures + test_reverse() ? 0;
    puts("");
    
    failures = failures + test_fill() ? 0;
    puts("");
    
    failures = failures + test_min_max() ? 0;
    puts("");
    
    failures = failures + test_sum() ? 0;
    puts("");
    
    failures = failures + test_is_sorted() ? 0;
    puts("");
    
    if (failures == 0) {
        puts("=== All Collections Tests Passed! ===");
        return 0;
    }
    
    puts("=== Some Tests Failed ===");
    return 1;
};
